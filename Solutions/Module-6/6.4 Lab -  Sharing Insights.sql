{"version":"NotebookV1","origId":3623476344927387,"name":"6.4 Lab -  Sharing Insights","language":"sql","commands":[{"version":"CommandV1","origId":3623476344927388,"guid":"b1d0d439-c3d4-4b0a-8768-52ed0a573b5e","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md-sandbox\n\n<div style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://databricks.com/wp-content/uploads/2018/03/db-academy-rgb-1200px.png\" alt=\"Databricks Learning\" style=\"width: 600px\">\n</div>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"23f3f31d-594b-495d-897e-9fcb92331c2e"},{"version":"CommandV1","origId":3623476344927389,"guid":"27993e1f-1ff3-4f46-bfbf-7e3cdfc27c24","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Lab 3 - Sharing Insights\n## Module 6 Assignment\n\nIn this lab, we will explore a small mock data set from a group of data centers. You'll see that is is similar to the data you have been working with, but it contains a few new columns and it is structured slightly differently to test your skills with hierarchical data manipulation. \n\n## ![Spark Logo Tiny](https://files.training.databricks.com/images/105/logo_spark_tiny.png) In this assignment you will: </br>\n\n* Apply higher-order functions to array data\n* Apply advanced aggregation and summary techniques to process data\n* Present data in an interactive dashboard or static file \n\nAs you work through the following tasks, you will be prompted to enter selected answers in Coursera. Find the quiz associated with this lab to enter your answers. \n\nRun the cell below to prepare this workspace for the lab. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d74f8c91-46f4-4a10-a010-0da3b9d445c0"},{"version":"CommandV1","origId":3623476344927390,"guid":"fbf89952-610d-4467-8ad0-8342fc20c285","subtype":"command","commandType":"auto","position":3.0,"command":"%run ../Includes/Classroom-Setup","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e8771b30-96e6-49b1-a538-34fd43431a40"},{"version":"CommandV1","origId":3623476344927391,"guid":"c50b0605-8cf1-4539-930a-0c6350075373","subtype":"command","commandType":"auto","position":4.0,"command":"%md\n### Exercise 1: Create a table\n\n**Summary:** Create a table. \n\nUse this path to access the data: `/mnt/training/iot-devices/data-centers/energy.json`\n\nSteps to complete: \n* Write a `CREATE TABLE` statement for the data located at the endpoint listed above\n* Use json as the file format","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"582e0eb0-e813-461b-bf39-a7be26aeb7f9"},{"version":"CommandV1","origId":3623476344927392,"guid":"b9e42771-bbbd-498f-9767-270ebc23d7e3","subtype":"command","commandType":"auto","position":5.0,"command":"--ANSWER\nDROP TABLE IF EXISTS DCDeviceDataRaw;\nCREATE TABLE DCDeviceDataRaw\nUSING json                           \nOPTIONS (\n    PATH \"/mnt/training/iot-devices/data-centers/energy.json\"\n    );\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e6c20c80-2304-4bb8-8824-8900a7de579b"},{"version":"CommandV1","origId":3623476344927393,"guid":"994fece2-d430-4a32-83f7-78f5da65796c","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n### Exercise 2: Sample the table\n\n**Summary:** Sample the table to get a closer look at a few rows\n\nSteps to complete: \n* Write a query that allows you to see a few rows of the data","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ae885b5c-250b-419c-b3b2-5cc7e0280b00"},{"version":"CommandV1","origId":3623476344927394,"guid":"d0ae4f6c-816f-4711-8d59-fb1ade1670fa","subtype":"command","commandType":"auto","position":7.0,"command":"--ANSWER\nSELECT * FROM DCDeviceDataRaw TABLESAMPLE(5 ROWS) ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"835f6a00-8ba6-4759-8a6b-28febc417d0e"},{"version":"CommandV1","origId":3623476344927395,"guid":"d9c2ae13-5ac8-4aae-aeda-fd7668a32e67","subtype":"command","commandType":"auto","position":8.0,"command":"%md\n### Exercise 3: Create view\n\n**Summary:** Create a temporary view that displays the timestamp column as a timestamp. \n\nSteps to complete: \n* Create a temporary view named `DCDevices`\n* Convert the `timestamp` column to a timestamp type. Refer to the [Datetime patterns](https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html#) documentation for the formatting information. \n* (Optional) Rename columns to use camelCase","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"052cd29e-097d-4bca-9e66-5b4ca0b04e43"},{"version":"CommandV1","origId":3623476344927396,"guid":"e36f7139-bba4-4157-92ea-c907a31bad2b","subtype":"command","commandType":"auto","position":9.0,"command":"--ANSWER\nCREATE\nOR REPLACE TEMPORARY VIEW DCDevices AS\nSELECT\n  device_id deviceId,\n  device_type deviceType,\n  battery_level batteryLevel,\n  co2_level co2Level,\n  signal,\n  temps,\n  to_timestamp(timestamp, 'yyyy/MM/dd HH:mm:ss') time\nFROM\n  DCDeviceDataRaw;\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b5c722a4-a14e-4d0c-ba45-8cdd4c4bd0c7"},{"version":"CommandV1","origId":3623476344927397,"guid":"cc8bfb26-bcae-46a8-9b43-90fbdf8bc0da","subtype":"command","commandType":"auto","position":10.0,"command":"%md\n### Exercise 4: Flag records with defective batteries\n\n**Summary:** When a battery is malfunctioning, it can report negative battery levels. Create a new boolean column `needService` that shows whether a device needs service.  \n\nSteps to complete: \n* Write a query that shows which devices have malfunctioning batteries\n* Include columns `batteryLevel`, `deviceId`, and `needService`\n* Order the results by `deviceId`, and then `batteryLevel`\n* **Answer the corresponding question in Coursera**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3aedb45c-6562-4449-acfb-375d7a6ef4c4"},{"version":"CommandV1","origId":3623476344927398,"guid":"a9ce749a-99e6-4a46-a3b2-6a300055a779","subtype":"command","commandType":"auto","position":11.0,"command":"--ANSWER\nSELECT\n  deviceId,\n  batteryLevel,\n  EXISTS(batteryLevel, level -> level < 0) needService\nFROM\n  DCDevices\nORDER BY deviceId, batteryLevel \n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f652149e-7148-41a7-af61-fe3262c5015d"},{"version":"CommandV1","origId":3623476344927399,"guid":"af1d2dad-0a99-4c96-b556-15ffccc454b0","subtype":"command","commandType":"auto","position":12.0,"command":"%md-sandbox\n### Exercise 5: Display high CO<sub>2</sub> levels\n\n**Summary:** Create a new column to display only CO<sub>2</sub> levels that exceed 1400 ppm. \n\nSteps to complete: \n* Include columns `deviceId`, `deviceType`, `highCO2`, `time`\n* The column `highCO2` should contain an array of CO<sub>2</sub> readings over 1400\n* Show only records that contain `highCO2` values\n* Order by `deviceId`, and then `highCO2`\n\n**Answer the corresponding question in Coursera**\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> You may need to use a subquery to write this in a single query statement. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"394eb553-c51a-4d3f-9f84-9bb2543e43d2"},{"version":"CommandV1","origId":3623476344927400,"guid":"b49d2c46-eaf2-4aba-bfa5-5324a6271441","subtype":"command","commandType":"auto","position":13.0,"command":"--ANSWER\nSELECT\n  deviceId,\n  deviceType,\n  highCO2,\n  time\nFROM (SELECT * , FILTER(co2Level, level -> level > 1400) highCO2 FROM DCDevices)\nWHERE size(highCO2) > 0\nORDER BY deviceId, highCO2\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"467d63da-46fa-4c3f-95fb-a8069e350b42"},{"version":"CommandV1","origId":3623476344927401,"guid":"92a0dfbb-6c4c-413c-a014-a8c9e6ab9309","subtype":"command","commandType":"auto","position":14.0,"command":"%md\n### Exercise 6: Create a partitioned table\n\n**Summary:** Create a new table partitioned by `deviceId`\n\nSteps to complete: \n* Include all columns\n* Create the table using Parquet\n* Rename the partitioned column `p_deviceId`\n* Run a `SELECT *`  to view your table. \n\n**Answer the corresponding question in Coursera**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d15c89d7-1cef-4b8b-916d-5f94597e93e5"},{"version":"CommandV1","origId":3623476344927402,"guid":"6d3abbb3-fba4-4e2b-9fb9-c7d729afd324","subtype":"command","commandType":"auto","position":15.0,"command":"--ANSWER\nDROP TABLE IF EXISTS byDevice;\nCREATE TABLE byDevice\nUSING\n  parquet\nPARTITIONED BY\n  (p_deviceId) AS\nSELECT\n  deviceType,\n  batteryLevel,\n  co2Level,\n  signal,\n  temps,\n  time,\n  deviceId AS p_deviceId\nFROM\n  DCDevices;\n\nSELECT * FROM byDevice","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d851afd9-d3c5-4de4-986e-ca3e3033d670"},{"version":"CommandV1","origId":3623476344927403,"guid":"f5ae8d2a-f46a-4c23-9014-d23bb1fcde77","subtype":"command","commandType":"auto","position":16.0,"command":"%md\n### Exercise 7: Visualize average temperatures ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"13237ae0-a1e7-47b4-90fd-1c3d31b8805a"},{"version":"CommandV1","origId":3623476344927404,"guid":"9b653fe0-8cca-4f7f-b2a6-ae8318285180","subtype":"command","commandType":"auto","position":17.0,"command":"--ANSWER\nSELECT \n  deviceType,\n  REDUCE(temps, BIGINT(0), (t, a) -> t + a, a -> (a div size(temps))) AS avg_temps,\n   to_date(time) AS dte\nFROM \n  byDevice\n  ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1d89026d-848e-4def-a7f8-54cbf4dfd83f"},{"version":"CommandV1","origId":3623476344927405,"guid":"b9273435-cadf-43ab-adab-f09de64732e8","subtype":"command","commandType":"auto","position":18.0,"command":"%md\n### Exercise 8: Create a widget","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c30b6234-9336-4b7a-8c8e-c02165b5f80c"},{"version":"CommandV1","origId":3623476344927406,"guid":"4307f793-2b4e-41fa-a6e4-39cdeba337ab","subtype":"command","commandType":"auto","position":19.0,"command":"--ANSWER\nCREATE WIDGET DROPDOWN selectedDeviceId DEFAULT \"0\" CHOICES\nSELECT\n  DISTINCT deviceId\nFROM\n  DCDevices\nORDER BY deviceId","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0f463363-5559-4bb3-a826-ef84bcf7e6d2"},{"version":"CommandV1","origId":3623476344927407,"guid":"7c907bf7-2b9a-4e6a-97be-104aa19b28d0","subtype":"command","commandType":"auto","position":20.0,"command":"%md\n### Exercise 9: Use the widget in a query","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ed345996-3e74-4890-844f-f48e8774e7b1"},{"version":"CommandV1","origId":3623476344927408,"guid":"8eb60ee6-bf76-4e7b-a39e-bac7a61f18a0","subtype":"command","commandType":"auto","position":21.0,"command":"--ANSWER\nSELECT \n  getArgument(\"selectedDeviceId\") AS selectedDeviceId,\n  REDUCE(temps, BIGINT(0), (t, a) -> t + a, a -> (a div size(temps))) AS avg_temps,\n   to_date(time) AS dte\nFROM \n  byDevice\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dd9c4c4c-2f09-4c85-a110-7597f7b74e46"},{"version":"CommandV1","origId":3623476344927409,"guid":"d20a5e18-a520-4064-b1ba-b561e372f16b","subtype":"command","commandType":"auto","position":22.0,"command":"%md-sandbox\n&copy; 2020 Databricks, Inc. All rights reserved.<br/>\nApache, Apache Spark, Spark and the Spark logo are trademarks of the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>.<br/>\n<br/>\n<a href=\"https://databricks.com/privacy-policy\">Privacy Policy</a> | <a href=\"https://databricks.com/terms-of-use\">Terms of Use</a> | <a href=\"http://help.databricks.com/\">Support</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"58464599-82fd-4679-b6da-9900f6d89ab2"}],"dashboards":[],"guid":"b4699e2b-da28-409c-8e16-8b1a7aecd59a","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{}}