{"version":"NotebookV1","origId":3623476344927769,"name":"07 - Higher Order Functions","language":"sql","commands":[{"version":"CommandV1","origId":3623476344927770,"guid":"423502fa-d82b-415e-973a-ebebc54ababb","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md-sandbox\n\n<div style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://databricks.com/wp-content/uploads/2018/03/db-academy-rgb-1200px.png\" alt=\"Databricks Learning\" style=\"width: 600px\">\n</div>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"617aa047-2153-4f20-87f6-9626f27b3053"},{"version":"CommandV1","origId":3623476344927771,"guid":"0c43cc8e-d07d-496d-95df-fbe0738d0131","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n## Create Tables\nRun the cell below to create tables for the questions in this notebook. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"42d74d5e-a3c5-447b-9bc5-cedfb26076eb"},{"version":"CommandV1","origId":3623476344927772,"guid":"9d7b40c1-1a5e-45e2-9740-8315adc47caf","subtype":"command","commandType":"auto","position":3.0,"command":"%run ../Utilities/07-CreateTables","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bac5240d-dfc0-4b34-86f0-8bfe0cb78c28"},{"version":"CommandV1","origId":3623476344927773,"guid":"f48b4b8f-a774-4c7e-941b-3880c9e9fa42","subtype":"command","commandType":"auto","position":4.0,"command":"%md\n## Question 1: Transform\n### Summary\nUse the **`TRANSFORM`** function and the table **`finances`** to calculate **`interest`** for all cards issued to each user. \n\n\n### Steps to complete\nWrite a SQL query that achieves the following: \n* Displays cardholder's **`firstName`**, **`lastName`**, and a new column named **`interest`**\n* Uses **`TRANSFORM`** to extract charges for each card in the expenses column and calculates interest owed assuming a rate of 6.25%. \n* Stores the new values as an array in the interest column\n* Stores results in a temporary table named `q1Results`\n\nA properly completed solution should return a view that looks similar to this:\n\n| firstName | lastName | interest |\n|----------- |---------|----------|\n|Lance|Da Costa|[138.9, 373.55, 158.97]|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f009eb1f-d32f-4bd0-b130-3e6f82120f90"},{"version":"CommandV1","origId":3623476344927774,"guid":"2f389bc2-0e74-4f1d-8fa4-f4807f74e9e1","subtype":"command","commandType":"auto","position":5.0,"command":"--TODO  Answer 1","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"96461221-6948-4918-988a-ea1e93e3f4cb"},{"version":"CommandV1","origId":3623476344927775,"guid":"16bbf2bf-603a-439c-95ca-a02ab5a58328","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n## Question 2: Exists\n### Summary\nUse the table from Question 1, **`finances`**, to flag users whose records indicate that they made a late payment. \n\n### Steps to complete\nWrite a SQL query that achieves the following: \n* Displays cardholder's **`firstName`**, **`lastName`**, and a new column named **`lateFee`**\n* Uses the EXISTS function to flag customers who have made been charged a late payment fee.\n* Store the results in a temporary view named **`q2Results`**\n   \nA properly completed solution should return a DataFrame that looks similar to this:\n\n| firstName | lastName | lateFee |\n|---------- |----------| ------- |\n|Lance|DaCosta |true|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"84be7415-557e-43f7-808c-c8747a77dc32"},{"version":"CommandV1","origId":3623476344927776,"guid":"25aa3809-d7dd-49f2-93a2-60cb9e37ed47","subtype":"command","commandType":"auto","position":7.0,"command":"--TODO  Answer 2","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4862c381-1276-4842-84ba-5c2ef8db5457"},{"version":"CommandV1","origId":3623476344927777,"guid":"1bb9951e-c2f6-4707-a2c4-1d6da9d88054","subtype":"command","commandType":"auto","position":8.0,"command":"%md\n## Question 3: Reduce\n### Summary\nUse the **`REDUCE`** function to produce a query on the table **`charges`** that calculates total charges in dollars and total charges in Japanese Yen. \n\n### Steps to complete\nWrite a SQL query that achieves the following: \n* Uses the **`REDUCE`** function to calculate the total charges in US Dollars (given)\n* Uses the **`REDUCE`** function to convert the total charges to Japanese Yen using a conversion rate where 1 USD = 107.26 JPY \n* Stores the results in a temporary table named **`q3Results`**\n   \n**NOTE:** In the `REDUCE` function, the accumulator must be of the same type as the input. You will have to `CAST` the accumulator as a `DOUBLE` to use this function with this data. \nexample: `CAST (0 AS DOUBLE`)\n\nA properly completed solution should return a DataFrame that looks similar to this:\n\n| firstName | lastName | allCharges | totalDollars | totalYen |\n|---------- |----------| ------- | --------| ----------|\n|Lance|DaCosta |[\"2222.46\", \"5976.76\", \"2543.55\"]|10742.77|1152269.51|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a88c4021-50a5-4d3c-96fe-3c6f60e93925"},{"version":"CommandV1","origId":3623476344927778,"guid":"ccda6af8-d326-4c36-8e97-c26f8daeeba1","subtype":"command","commandType":"auto","position":9.0,"command":"--TODO   Answer 3\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e9a7c032-233b-4c8f-b193-e0ded71978b1"},{"version":"CommandV1","origId":3623476344927779,"guid":"32e91608-de5e-4c28-8b2a-c8eb74e4c221","subtype":"command","commandType":"auto","position":10.0,"command":"%md-sandbox\n&copy; 2020 Databricks, Inc. All rights reserved.<br/>\nApache, Apache Spark, Spark and the Spark logo are trademarks of the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>.<br/>\n<br/>\n<a href=\"https://databricks.com/privacy-policy\">Privacy Policy</a> | <a href=\"https://databricks.com/terms-of-use\">Terms of Use</a> | <a href=\"http://help.databricks.com/\">Support</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4da7074f-6c20-4504-9ee2-12d93c5a84ee"}],"dashboards":[],"guid":"58f69767-9d5b-4934-b16d-b6a28311c272","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2}}