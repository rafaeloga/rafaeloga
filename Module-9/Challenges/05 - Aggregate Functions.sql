{"version":"NotebookV1","origId":3623476344927727,"name":"05 - Aggregate Functions","language":"sql","commands":[{"version":"CommandV1","origId":3623476344927728,"guid":"a6be554b-d4d0-4117-b61d-0bf6379c0b22","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md-sandbox\n\n<div style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://databricks.com/wp-content/uploads/2018/03/db-academy-rgb-1200px.png\" alt=\"Databricks Learning\" style=\"width: 600px\">\n</div>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cf268215-eaa5-43df-a709-d4c29fa680c3"},{"version":"CommandV1","origId":3623476344927729,"guid":"27cb990b-a604-477d-85a5-d8c397916c45","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n## Create Tables\nRun the cell below to create tables for the questions in this notebook. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"aedb45b5-8c87-44ca-9947-5cd825350caa"},{"version":"CommandV1","origId":3623476344927730,"guid":"b8678cc7-dddf-4911-ac7b-e4b59cdd6746","subtype":"command","commandType":"auto","position":3.0,"command":"%run ../Utilities/05-CreateTables","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bdb78f89-8076-45e0-8928-76a1137ec123"},{"version":"CommandV1","origId":3623476344927731,"guid":"b8f5dda6-c304-4c89-9fc2-2fec1fdb1650","subtype":"command","commandType":"auto","position":4.0,"command":"%md\n## Question 1: Min Function\n### Summary\nCompute the minimum value from the **`Amount`** field for each unique value in the **`TrueFalse`** field in the table **`revenue1`**.\n\n### Steps to complete\nWrite a SQL query that achieves the following: \n* Computes the number of **`true`** and **`false`** records in the **`TrueFalse`** field from the table **`revenue1`**\n* Renames the new column to **`count`**\n* Store the records in a temporary view named  **`q1Results`** with the following schema:\n\n| column | type |\n|--------|--------|\n| TrueFalse | boolean |\n| MinAmount | int |\n\nA properly completed solution should produce a view similar to this sample output:\n\n|TrueFalse|         count |\n|---------|------------------|\n|     true|        4956|\n|    false|        5044|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fa83d590-9ced-4110-87ab-00642c832e95"},{"version":"CommandV1","origId":3623476344927732,"guid":"a198c978-ac1b-4cc5-946c-453ad10ec9e0","subtype":"command","commandType":"auto","position":5.0,"command":"-- TODO  Answer 1","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e0aa1ffa-4e7d-4cf6-8514-ab715f2feb3d"},{"version":"CommandV1","origId":3623476344927733,"guid":"42de64ef-5994-412c-b897-c87ea216afaa","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n## Question 2: Max Function\n### Summary\nCompute the maximum value from the **`Amount`** field for each unique value in the **`TrueFalse`** field in the table **`revenue2`**.\n\n### Steps to complete\n* Computes the maximum **`Amount`** for **`True`** records and **`False`** records from the **`TrueFalse`** field from the table **`revenue2`**\n* Renames the new column to **`maxAmount`**\n* Store the records in a temporary view named  **`q2Results`** with the following schema:\n   \n| column | type |\n|--------|--------|\n| TrueFalse | boolean |\n| maxAmount | double |\n\nA properly completed solution should produce a DataFrame similar to this sample output:\n\n|TrueFalse|         MaxAmount|\n|---------|------------------|\n|     true|        2243937.93|\n|    false|2559457.1799999997|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"60d94a18-6e50-4e0c-a3e4-4951b49c8f13"},{"version":"CommandV1","origId":3623476344927734,"guid":"4794f58f-8562-4869-833e-876d90ebec83","subtype":"command","commandType":"auto","position":7.0,"command":"-- TODO  Answer 2","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"14e7c8b0-8db0-4f3f-835b-73e6a443158c"},{"version":"CommandV1","origId":3623476344927735,"guid":"99069838-c486-4986-81bb-559d5dd4b187","subtype":"command","commandType":"auto","position":8.0,"command":"%md\n## Question 3: Avg Function\n### Summary\nCompute the average of the **`Amount`** field for each unique value in the **`TrueFalse`** field in the table **`revenue3`**.\n\n### Steps to complete\n\n* Computes the average of **`Amount`** for **`True`** records and **`False`** records from the **`TrueFalse`** field in the table **`revenue3`**.\n* Renames the new column to **`avgAmount`**\n* Store the records in a temporary view named  **`q3Results`** with the following schema:\n\n| column | type |\n|--------|--------|\n| TrueFalse | boolean |\n| avgAmount | double |\n\nA properly completed solution should produce a DataFrame similar to this sample output:\n\n|TrueFalse|         AvgAmount|\n|---------|------------------|\n|     true|        2243937.93|\n|    false|2559457.1799999997|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"24b7db27-17f5-4890-ab69-efca2730a048"},{"version":"CommandV1","origId":3623476344927736,"guid":"f3ca9e03-a8b5-4599-9f6c-0233ea6f5861","subtype":"command","commandType":"auto","position":9.0,"command":"-- TODO  Answer 3","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c2d8708f-3271-41fe-825d-b63567aa1ee0"},{"version":"CommandV1","origId":3623476344927737,"guid":"29bdfdd0-d6d0-4068-b4a2-09ce317de256","subtype":"command","commandType":"auto","position":10.0,"command":"%md\n## Question 4: Pivot\n### Summary\nCalculate the total **`Amount`** for **`YesNo`** values of **true** and **false** in 2002 and 2003 from the table **`revenue4`**.\n    \n### Steps to complete\n* Casts the **`UTCTime`** field to Timestamp and names the new column **`Date`**\n* Extracts a **`Year`** column from the **`Date`** column\n* Filters for years greater than 2001 and less than or equal to 2003\n* Groups by **`YesNo`** and creates a pivot table to get the total **`Amount`** for each year and each value in **`YesNo`**\n* Represents each total amount as a float rounded to two decimal places\n* Store the results into a temporary table named **`q4results`**\n   \nA properly completed solution should produce a view similar to this sample output:\n\n|YesNo|    2002|    2003|\n|-----|--------|--------|\n| true| 61632.3| 8108.47|\n|false|44699.99|35062.22|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b8d0c5fb-693a-4d34-a569-4a09fac8bdea"},{"version":"CommandV1","origId":3623476344927738,"guid":"8becb3f5-fce9-4e8c-bea6-5e887e6a7895","subtype":"command","commandType":"auto","position":11.0,"command":"-- TODO  Answer 4","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"43537f93-b02c-4ac3-b839-76f6f72dbe87"},{"version":"CommandV1","origId":3623476344927739,"guid":"6850dfd1-7a1b-4ce0-a142-6e01c7990086","subtype":"command","commandType":"auto","position":12.0,"command":"%md\n## Question 5: Null Values and Aggregates\n### Summary\nCompute sums of **`amount`** grouped by **`aisle`** after dropping null values from **`products`** table.\n\n### Steps to complete\n\n* Drops any rows that contain null values in either the **`itemId`** or the **`aisle`** column\n* Aggregates sums of the **`amount`** column grouped by **`aisle`**\n* Store the results into a temporary view named  **`q5Results`**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d158e613-b46a-4c36-a582-0bbae1a1dae0"},{"version":"CommandV1","origId":3623476344927740,"guid":"595e818d-efa6-43bb-ab71-85f1da629d31","subtype":"command","commandType":"auto","position":13.0,"command":"-- TODO  Answer 5","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"354cfd51-d02a-4a0f-9c98-45c71fcfa67d"},{"version":"CommandV1","origId":3623476344927741,"guid":"9b7c7076-c18d-4521-a24d-8536e942853f","subtype":"command","commandType":"auto","position":14.0,"command":"%md\n## Question 6: Generate Subtotals By Rollup\n### Summary\nCompute averages of **`income`** grouped by **`itemName`** and **`month`** such that the results include averages across all months as well as a subtotal for an individual month from the **`sales`** table. \n\n### Steps to complete\n\n* Coalesces null values in the **`month`** column generated by the `ROLLUP` clause\n* Store the results into a temporary view named  **`q6Results`**\n\nYour results should look something like this: \n\n| itemName| month | avgRevenue |\n| --------| ----- | ---------- |\n| Anim | 10 | 4794.16 |\n| Anim | 7 | 5551.31 |\n| Anim | All months | 5046.54 |\n| Aute | 4 | 4069.51 |\n| Aute | 7 | 3479.31 |\n| Aute | 8 | 6339.28 |\n| Aute | All months |  4489.41 |\n| ... | ... | ... | ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8852d52e-bab6-4ac3-9b31-5e8e4255b208"},{"version":"CommandV1","origId":3623476344927742,"guid":"93825c87-c052-4500-99a2-7715c7a09adf","subtype":"command","commandType":"auto","position":15.0,"command":"--TODO  Answer 6\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9ea7b0bc-5dc5-46d6-a42e-de7e149d6f53"},{"version":"CommandV1","origId":3623476344927743,"guid":"f2411a5c-7dc5-4594-9419-f4bb4664bfac","subtype":"command","commandType":"auto","position":16.0,"command":"%md-sandbox\n&copy; 2020 Databricks, Inc. All rights reserved.<br/>\nApache, Apache Spark, Spark and the Spark logo are trademarks of the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>.<br/>\n<br/>\n<a href=\"https://databricks.com/privacy-policy\">Privacy Policy</a> | <a href=\"https://databricks.com/terms-of-use\">Terms of Use</a> | <a href=\"http://help.databricks.com/\">Support</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ef79a940-e3b8-405b-9a6c-081a9ebf649d"}],"dashboards":[],"guid":"10aac751-3364-4163-a00e-33d74ef12b6d","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2}}