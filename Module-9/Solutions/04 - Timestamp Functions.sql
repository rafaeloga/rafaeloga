{"version":"NotebookV1","origId":3623476344927708,"name":"04 - Timestamp Functions","language":"sql","commands":[{"version":"CommandV1","origId":3623476344927709,"guid":"a4279f48-5048-4133-9e89-943062664d43","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md-sandbox\n\n<div style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://databricks.com/wp-content/uploads/2018/03/db-academy-rgb-1200px.png\" alt=\"Databricks Learning\" style=\"width: 600px\">\n</div>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b2bb151e-1928-49da-9889-ef789269b5fa"},{"version":"CommandV1","origId":3623476344927710,"guid":"ed93fcbe-f9a5-4a33-aecc-1b213c82cd33","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n## Create Tables\nRun the cell below to create tables for the questions in this notebook. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ba9b5593-de3c-4c29-83b4-81a7fa24938d"},{"version":"CommandV1","origId":3623476344927711,"guid":"3b56a590-e4fe-460b-ada8-9d261388eb37","subtype":"command","commandType":"auto","position":3.0,"command":"%run ../Utilities/04-CreateTables","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"687dd582-3ccb-482f-b2de-00f520555ad2"},{"version":"CommandV1","origId":3623476344927712,"guid":"80c113aa-2905-4f4b-81d8-f4075ba0f24b","subtype":"command","commandType":"auto","position":4.0,"command":"%md-sandbox\n## Question 1: Extract Year and Month\n### Summary\nExtract the year and month from the **`Timestamp`** field in the table **`timetable1`** and store records with only the 12th month into **`q1Results`** table.\n\n### Steps to complete\nWrite a SQL query that achieves the following: \n  * Extracts the **`year`** and **`month`** from the **`Timestamp`** column from the table **`timetable1`**\n    - **`Timestamp`** is an integer representing seconds since midnight on January 1st, 1970 (e.g. 1519344286). You must cast it as a `timestamp` to to extract years and months. \n  * Filters records to include only month 12\n  * Stores the resulting records in a temporary view named **`q1Results`** with the following schema.\n\n| column | type |\n|--------|--------|\n| Date | timestamp |\n| Year | integer |\n| Month | integer |\n\n\nA properly completed solution should produce a DataFrame similar to this sample output:\n\n|               Date|Year|Month|\n|-------------------|----|-----|\n|2010-12-15 21:36:55|2010|   12|\n|2002-12-01 11:17:54|2002|   12|\n|2017-12-13 11:28:03|2017|   12|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b07f241f-bb6d-420b-8365-d7ce178b91d4"},{"version":"CommandV1","origId":3623476344927713,"guid":"df8f9064-255c-440b-bd76-37b8b2fe0dd2","subtype":"command","commandType":"auto","position":5.0,"command":"--ANSWER\nCREATE OR REPLACE TEMPORARY VIEW q1Results AS \n  WITH datesTable AS\n    (SELECT\n    CAST(Timestamp AS timestamp) AS date FROM timetable1)\n  SELECT date, \n  year(date) AS year, \n  month(date) AS month\n  FROM datesTable\n  WHERE month(date) =12;\n  \nSELECT * FROM q1Results;","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c1e58358-292f-4114-a823-f7dac45de3e3"},{"version":"CommandV1","origId":3623476344927714,"guid":"225837f3-0610-486b-85f6-6779e5d78c2c","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n## Question 2: Extract year, month, and day of year\n### Summary\nExtract the **year**, **month** and **dayofyear**  from the **`Timestamp`** field in the table **`timetable2`** and return records for **only** the 4th month.\n\n### Steps to complete\nWrite a SQL query that achieves the following:\n* Create **`Year`**, **`Month`** and **`DayOfYear`** columns from the **`Timestamp`** column in the **`timetable2`** table\n   - **`Timestamp`** is an integer representing seconds since midnight on January 1st, 1970 (e.g. 1519344286). You must cast it as a `timestamp` to to extract years, months, and day of year. \n* Filter records to include only month 4 \n* Stores the records in a temporary table named  **`q2Results`** with the following schema:\n\n| column    | type      |\n|-----------|-----------|\n| Date      | timestamp |\n| Year      | integer   |\n| Month     | integer   |\n| DayOfYear | integer   |\n<br>\n\n* A properly completed solution should produce a DataFrame similar to this sample output:\n\n|               Date|Year|Month| DayOfYear |\n|-------------------|----|-----|-----------|\n|2002-04-22 06:41:39|2002|    4|      112  |\n|2012-04-01 05:00:06|2012|    4|       92  |\n|2019-04-05 12:38:42|2019|    4|       95  |","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"eb713799-2c41-4438-83c7-d21b29eff47b"},{"version":"CommandV1","origId":3623476344927715,"guid":"ddaf4887-0e93-4cfd-bad8-a4a893fcc2a0","subtype":"command","commandType":"auto","position":7.0,"command":"--ANSWER\nCREATE OR REPLACE TEMPORARY VIEW q2Results AS\n  WITH datesTable AS\n    (SELECT\n    CAST(Timestamp AS timestamp) AS date FROM timetable2)\n  SELECT date, \n  year(date) AS year, \n  month(date) AS month,\n  dayofyear(Date) AS DayOfYear\n  FROM datesTable\n  WHERE month(date) = 4;\n  \nSELECT * FROM q2Results;\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a9c3defc-4ab3-4b50-a225-0f013804ab1c"},{"version":"CommandV1","origId":3623476344927716,"guid":"3e9770a8-2eae-4659-9fc2-5d0727fd8455","subtype":"command","commandType":"auto","position":8.0,"command":"%md-sandbox\n&copy; 2020 Databricks, Inc. All rights reserved.<br/>\nApache, Apache Spark, Spark and the Spark logo are trademarks of the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>.<br/>\n<br/>\n<a href=\"https://databricks.com/privacy-policy\">Privacy Policy</a> | <a href=\"https://databricks.com/terms-of-use\">Terms of Use</a> | <a href=\"http://help.databricks.com/\">Support</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bcdaa587-bfa7-40df-8409-0184b2885f51"}],"dashboards":[],"guid":"9d32a397-a2e5-4071-80ae-29a120d23af3","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{}}