{"version":"NotebookV1","origId":3623476344927683,"name":"02 - Manage Query Results","language":"sql","commands":[{"version":"CommandV1","origId":3623476344927684,"guid":"16999031-a606-4a5c-b1ef-16c325422708","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md-sandbox\n\n<div style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://databricks.com/wp-content/uploads/2018/03/db-academy-rgb-1200px.png\" alt=\"Databricks Learning\" style=\"width: 600px\">\n</div>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b335075f-a6a7-45f0-b215-9fead4e8ffd2"},{"version":"CommandV1","origId":3623476344927685,"guid":"d07f00ec-08fc-4e70-a0dd-5d10a9db191a","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n## Create Tables\nRun the cell below to create tables for the questions in this notebook. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9ed5de90-04db-41dd-8c3c-7825eddc2d54"},{"version":"CommandV1","origId":3623476344927686,"guid":"f84903b3-ae67-46fb-b5ed-259dd6aca583","subtype":"command","commandType":"auto","position":3.0,"command":"%run ../Utilities/02-CreateTables","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b432f3ff-6aae-498e-b530-3a0ea0133d23"},{"version":"CommandV1","origId":3623476344927687,"guid":"3e6cd277-6ac9-4ccf-9b84-034e2f6285e7","subtype":"command","commandType":"auto","position":4.0,"command":"%md\n\n## Question 1: Dedupe Sort\n### Summary\nDeduplicate and sort data on products that need to be restocked in a grocery store.\n\n### Steps to complete\nWrite a SQL query on the **`products`** table that achieves the following:\n* Removes duplicate rows \n* Sorts rows by the **`aisle`** column in ascending order (with nulls appearing last), and then by **`price`** in ascending order\n* Stores the results into a temporary view named  **`q1Results`**\n   \n   \nA properly completed solution should return both a DataFrame that looks similar to this:\n\n|itemId|amount|aisle|price|\n|---|---|---|---|\n|  9958|    64|    2|    2|\n|  1432|    23|    3|   24|\n|  3242|    14|    5|    5|\n|...|...|...|...|\n|  7064|    34| null|   24|\n|  0244|    7| null|   36|","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"af3a8429-d31e-46ff-b135-f02aa3a5820a"},{"version":"CommandV1","origId":3623476344927688,"guid":"2f2cc656-e884-445f-9c4a-7b8dcbf0ead1","subtype":"command","commandType":"auto","position":5.0,"command":"--ANSWER\nCREATE OR REPLACE TEMPORARY VIEW q1Results AS\n  SELECT DISTINCT * FROM products \n    ORDER BY aisle ASC NULLS LAST, price ASC;\n    \nSELECT * FROM q1Results","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1716316f-b195-451d-a6f0-166c839e310f"},{"version":"CommandV1","origId":3623476344927689,"guid":"c15652a3-2232-47e5-9d20-bbc29d1dd155","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n## Question 2: Limit Results \n### Summary\nReturn the top five results for data that matches a set of criteria.\n\n### Steps to complete\nWrite a SQL query on the table **`raceResults`** that achieves the following: \n* Casts **`lastFinish`** column as date and renames to **`raceDate`**\n* Sorts rows by the **`winOdds`** column in descending order\n* Limits the results to the top 5 **`winOdds`**\n* Stores the results into a temporary view named  **`q2Results`**\n   \nA properly completed solution should return a DataFrame that looks similar to this:\n\n|name|winOdds|raceDate|\n|--- |-------|----------|\n| Dolor Incididunt|    .9634252|    2015-07-29| \n| Excepteur Mollit|    .9524401|    2019-08-15| \n| Magna Ad        |    .9420442|    2017-05-12| \n|  Sed In|.9325211| 2014-08-29|\n|  Qui Cupidat| .9242451| 2011-08-23| ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c7c928ac-2e44-4741-af9e-3ad3618c88e9"},{"version":"CommandV1","origId":3623476344927690,"guid":"bf80ff44-129e-424f-9b81-ef4331e8ef44","subtype":"command","commandType":"auto","position":7.0,"command":"--ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW q2Results AS\n  SELECT name, \n      winOdds, \n      to_date(lastFinish) AS raceDate\n  FROM raceResults\n  WHERE winOdds > 0.9 \n  ORDER BY winOdds DESC\n  LIMIT 5;\n\nSELECT * FROM q2Results;\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1afc35a8-44d4-41b2-a497-57a73505c51f"},{"version":"CommandV1","origId":3623476344927691,"guid":"15dbf2be-71c8-4868-8a54-c21f6054e729","subtype":"command","commandType":"auto","position":8.0,"command":"%md-sandbox\n&copy; 2020 Databricks, Inc. All rights reserved.<br/>\nApache, Apache Spark, Spark and the Spark logo are trademarks of the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>.<br/>\n<br/>\n<a href=\"https://databricks.com/privacy-policy\">Privacy Policy</a> | <a href=\"https://databricks.com/terms-of-use\">Terms of Use</a> | <a href=\"http://help.databricks.com/\">Support</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"41b07342-ef84-48b0-96d8-a20f050dbcf9"}],"dashboards":[],"guid":"338833a7-72cf-4380-9e8f-c334d5ced817","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{}}