{"version":"NotebookV1","origId":3623476344927805,"name":"07-CreateTables","language":"sql","commands":[{"version":"CommandV1","origId":3623476344927806,"guid":"5f745770-4611-4cb3-b5de-a46c0b2f1fe0","subtype":"command","commandType":"auto","position":1.0,"command":"\n%run ./Common","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"484754f0-b9b1-4c9b-aacc-05b35d005436"},{"version":"CommandV1","origId":3623476344927807,"guid":"24d63ce5-31d5-4bbd-a120-ccee5cef0558","subtype":"command","commandType":"auto","position":2.0,"command":"%python\n\n\nspark.conf.set(\"spark.sql.execution.arrow.pyspark.enabled\", \"false\")\nimport pandas as pd\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.types import *\n\njsonString = \"\"\"\n[{\n  \"id\": 1,\n  \"firstName\": \"Lance\",\n  \"lastName\": \"Da Costa\",\n  \"expenses\": [\n    {\n      \"cardType\": \"jcb\",\n      \"charges\": \"2222.46\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-18\",\n      \"paymentDue\": \"2020-07-18\"\n    },\n    {\n      \"cardType\": \"jcb\",\n      \"charges\": \"5976.76\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-01\",\n      \"paymentDue\": \"2020-07-22\"\n    },\n    {\n      \"cardType\": \"visa\",\n      \"charges\": \"2543.55\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-12\",\n      \"paymentDue\": \"2020-07-22\"\n    }\n  ]\n}, {\n  \"id\": 2,\n  \"firstName\": \"Emilie\",\n  \"lastName\": \"Newlove\",\n  \"expenses\": [\n    {\n      \"cardType\": \"bankcard\",\n      \"charges\": \"6344.33\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-10\",\n      \"paymentDue\": \"2020-07-08\"\n    }\n  ]\n}, {\n  \"id\": 3,\n  \"firstName\": \"Alvy\",\n  \"lastName\": \"Records\",\n  \"expenses\": [\n    {\n      \"cardType\": \"mastercard\",\n      \"charges\": \"9170.83\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-02\",\n      \"paymentDue\": \"2020-07-29\"\n    },\n    {\n      \"cardType\": \"maestro\",\n      \"charges\": \"3201.67\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-06\",\n      \"paymentDue\": \"2020-07-22\"\n    },\n    {\n      \"cardType\": \"americanexpress\",\n      \"charges\": \"6087.61\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-28\",\n      \"paymentDue\": \"2020-07-08\"\n    },\n    {\n      \"cardType\": \"americanexpress\",\n      \"charges\": \"3392.61\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-12\",\n      \"paymentDue\": \"2020-07-21\"\n    }\n  ]\n}, {\n  \"id\": 4,\n  \"firstName\": \"Jena\",\n  \"lastName\": \"Fairley\",\n  \"expenses\": [\n    {\n      \"cardType\": \"jcb\",\n      \"charges\": \"9726.16\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-25\",\n      \"paymentDue\": \"2020-07-17\"\n    },\n    {\n      \"cardType\": \"americanexpress\",\n      \"charges\": \"2578.18\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-27\",\n      \"paymentDue\": \"2020-07-14\"\n    }\n  ]\n}, {\n  \"id\": 5,\n  \"firstName\": \"Klarika\",\n  \"lastName\": \"Pady\",\n  \"expenses\": [\n    {\n      \"cardType\": \"bankcard\",\n      \"charges\": \"8460.46\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-12\",\n      \"paymentDue\": \"2020-07-17\"\n    },\n    {\n      \"cardType\": \"bankcard\",\n      \"charges\": \"8573.72\",\n      \"currency\": \"USD\",\n      \"lastPayment\": \"2020-07-11\",\n      \"paymentDue\": \"2020-07-08\"\n    }\n  ]\n}]\n\"\"\"\n\npandasDF = pd.read_json(jsonString)\ndataDF = spark.createDataFrame(pandasDF)\ndataDF.createOrReplaceTempView(\"finances\")\n\ndisplayHTML(\"\"\"\nDeclared the following table:\n  <li><span style=\"color:green; font-weight:bold\">finances</span></li>\n\"\"\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f0cecf6c-4c5e-4d34-95ac-0ebcad7f9606"},{"version":"CommandV1","origId":3623476344927808,"guid":"683156e8-73c9-445c-ace2-a7f0f0dfc6f1","subtype":"command","commandType":"auto","position":3.0,"command":"%python\n\n\nsqlContext.sql(\"\"\"CREATE OR REPLACE TEMPORARY VIEW charges AS\n  SELECT id, firstName, lastName, \n  TRANSFORM (expenses, card -> card.charges) AS allCharges\n  FROM finances\"\"\")\n\ndisplayHTML(\"\"\"\nDeclared the following table:\n  <li><span style=\"color:green; font-weight:bold\">charges</span></li>\n\"\"\")\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"621de41d-bd6e-4949-981f-18241566e32d"}],"dashboards":[],"guid":"d5efb55d-3f9f-4c5b-b49d-868b044b6ac1","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2}}