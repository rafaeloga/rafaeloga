{"version":"NotebookV1","origId":3623476344927098,"name":"8.1 Using Delta","language":"sql","commands":[{"version":"CommandV1","origId":3623476344927099,"guid":"15a289c5-9d4c-4860-8f0c-0112b58d8165","subtype":"command","commandType":"auto","position":1.0,"command":"\n%md-sandbox\n\n<div style=\"text-align: center; line-height: 0; padding-top: 9px;\">\n  <img src=\"https://databricks.com/wp-content/uploads/2018/03/db-academy-rgb-1200px.png\" alt=\"Databricks Learning\" style=\"width: 600px\">\n</div>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2e188447-97d6-4f65-8d8b-8f374f6c0410"},{"version":"CommandV1","origId":3623476344927100,"guid":"81b586be-3643-4491-b8db-86ca3c221ef4","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n## Using Delta\n\nMoovio, the fitness tracker company, is in the process of migrating non-Delta workloads to Delta Lake. You have access to the files that hold current data that you can experiment with while learning about how to work with Delta Lake. Creating Delta tables is as easy as issuing the command, `USING DELTA`. Get started by reading through the following cells and run the corresponding queries to create and modify Delta tables.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"eb65de2f-0400-45af-adfc-a8a45ad4fa24"},{"version":"CommandV1","origId":3623476344927101,"guid":"3a662b80-5761-4020-ac4a-c81fdbba325b","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n## Getting started\nRun the cell below to set up your classroom environment. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b68f0abb-3178-441d-a24f-7c4dd0c5a756"},{"version":"CommandV1","origId":3623476344927102,"guid":"57ea265f-a4c8-4c79-a614-600d2c65c938","subtype":"command","commandType":"auto","position":4.0,"command":"%run \"../Includes/Classroom-Setup\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0d9b2d24-8c39-4cbb-9e6c-a8e0f6c53774"},{"version":"CommandV1","origId":3623476344927103,"guid":"f54f3a97-2c5d-49f9-9826-1b319ef75d8a","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n## Create table\n\nTo start, we will create a table of the raw data we've been provided. We're using only a small sample of the available data, so this set is limited to 5 devices over the course of one month. The raw files are in the `.json` format. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6040b215-d864-43dc-b52d-aca62dc7e7d2"},{"version":"CommandV1","origId":3623476344927104,"guid":"259adbf1-c68f-4c9b-b180-6a760a0b3004","subtype":"command","commandType":"auto","position":6.0,"command":"DROP TABLE IF EXISTS health_tracker_data_2020_01;              \n\nCREATE TABLE health_tracker_data_2020_01                        \nUSING json                                             \nOPTIONS (\n  path \"dbfs:/mnt/training/healthcare/tracker/raw.json/health_tracker_data_2020_1.json\",\n  inferSchema \"true\"\n  );","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"568b8feb-4f08-4e99-a9c7-960723640192"},{"version":"CommandV1","origId":3623476344927105,"guid":"9373a1d3-a897-48fd-a759-5a19a3c05ed4","subtype":"command","commandType":"auto","position":7.0,"command":"%md\n## Preview data\n\nBefore we do anything else, let's quickly inspect the data by viewing a sample.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ce012c8b-984d-4eb9-9347-8edf376745d8"},{"version":"CommandV1","origId":3623476344927106,"guid":"980cabac-2f2e-43d4-a282-dcf71a8c5b09","subtype":"command","commandType":"auto","position":8.0,"command":"SELECT * FROM health_tracker_data_2020_01 TABLESAMPLE (5 ROWS)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"07e8abbf-eb30-4aef-a7b1-fae984adfa96"},{"version":"CommandV1","origId":3623476344927107,"guid":"64fbf181-473b-45b5-87af-7d03c2eceefa","subtype":"command","commandType":"auto","position":9.0,"command":"%md-sandbox\n## Create Delta table\n\nThis example, so far, is of a Bronze level table. We can display the raw data, but it is not easily queryable. Our next step is to create a cleaned Silver table. This table may flow into several business aggregate Gold level tables later on. In this step, we'll focus on creating an easily queryable table that includes most or all of the data, with all columns accurately typed and object properties unpacked into individual columns. \n\n\nRecall that a Delta table consists of three things: \n\n1. The Delta files (in object storage)\n1. The Delta [Transaction Log](https://databricks.com/blog/2019/08/21/diving-into-delta-lake-unpacking-the-transaction-log.html) saved with the Delta files in object storage. \n1. The Delta table registered in the [Metastore](https://docs.databricks.com/data/metastores/index.html#metastores) \n\nRun the cell below to create a new table using `DELTA`. This step registers your table in the metastore, converts your files to Delta and creates the transaction log, which will hold the record of every transaction that is performed on this table. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fc7013f5-5a44-4093-ab62-be278143436e"},{"version":"CommandV1","origId":3623476344927108,"guid":"09731ba3-acdb-4472-a690-791d8505103f","subtype":"command","commandType":"auto","position":10.0,"command":"CREATE OR REPLACE TABLE health_tracker_silver \nUSING DELTA\nPARTITIONED BY (p_device_id)\nLOCATION \"/health_tracker/silver\" AS (\nSELECT\n  value.name,\n  value.heartrate,\n  CAST(FROM_UNIXTIME(value.time) AS timestamp) AS time,\n  CAST(FROM_UNIXTIME(value.time) AS DATE) AS dte,\n  value.device_id p_device_id\nFROM\n  health_tracker_data_2020_01\n)\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2593b776-04b6-476f-95e8-33624ca67523"},{"version":"CommandV1","origId":3623476344927109,"guid":"ed716f57-4a98-4901-b641-9083f7f1b9da","subtype":"command","commandType":"auto","position":11.0,"command":"%md\nGreat! You have created your first Delta table! Run the `DESCRIBE DETAIL` command to view table details. You can see that the table format is `delta` and  it is stored in the location you specified.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"926d1048-ec8a-4eae-9b86-4aaf56f0daab"},{"version":"CommandV1","origId":3623476344927110,"guid":"4de8af06-937f-4d1c-a560-8f68c33a2f7f","subtype":"command","commandType":"auto","position":12.0,"command":"DESCRIBE DETAIL health_tracker_silver","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9d641d08-6efd-4d9e-a124-5c38642e3e9f"},{"version":"CommandV1","origId":3623476344927111,"guid":"f5be9b12-8e73-4367-9a4d-181f0e1d1158","subtype":"command","commandType":"auto","position":13.0,"command":"%md\n## Read in new data\n\nRecall that we created that table with just one month of data. Now let's see how we can add new data to that table. \n\nRun the cell below to read in the new raw file. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7a2d1753-c6e7-429d-ace0-ebe505110244"},{"version":"CommandV1","origId":3623476344927112,"guid":"aa671dc8-48b4-4acb-baba-232f45757558","subtype":"command","commandType":"auto","position":14.0,"command":"DROP TABLE IF EXISTS health_tracker_data_2020_02;              \n\nCREATE TABLE health_tracker_data_2020_02                        \nUSING json                                             \nOPTIONS (\n  path \"dbfs:/mnt/training/healthcare/tracker/raw.json/health_tracker_data_2020_2.json\",\n  inferSchema \"true\"\n  );","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f91f079d-d9a9-41f4-a26c-150a4f5978d0"},{"version":"CommandV1","origId":3623476344927113,"guid":"b528e421-f122-4696-a0e3-fb6e1863c78f","subtype":"command","commandType":"auto","position":15.0,"command":"%md\n## Append files\n\nWe can append the next month of of records to the existing table using the `INSERT INTO` command. We will transform the new data to match the existing schema. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4155fd48-4728-488a-9041-81e8f26ea7df"},{"version":"CommandV1","origId":3623476344927114,"guid":"2b5fef6a-9636-4b7d-9e8b-19f1fb1005dc","subtype":"command","commandType":"auto","position":16.0,"command":"INSERT INTO\n  health_tracker_silver\nSELECT\n  value.name,\n  value.heartrate,\n  CAST(FROM_UNIXTIME(value.time) AS timestamp) AS time,\n  CAST(FROM_UNIXTIME(value.time) AS DATE) AS dte,\n  value.device_id p_device_id\nFROM\n  health_tracker_data_2020_02","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b7844c61-467e-4cb0-9624-249fff03f06e"},{"version":"CommandV1","origId":3623476344927115,"guid":"678bb94d-5cc5-4ac1-8637-1c2225bbbce0","subtype":"command","commandType":"auto","position":17.0,"command":"%md\n## Time Travel: Count records in the previous table\n\nLet's count the records to verify that the append went as expected. First, we can write a query to show the count before we appended new records. Delta Lake can query an earlier version of a Delta table using a feature known as [time travel](https://docs.databricks.com/delta/quick-start.html#query-an-earlier-version-of-the-table-time-travel). \n\nWe demonstrate querying the data as of version 0, which is the initial conversion of the table from Parquet. \n\n**`5 devices * 24 hours * 31 days`** **`=`** **`3720 records`**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fbb37b15-8517-4892-b06a-0519d5e2118e"},{"version":"CommandV1","origId":3623476344927116,"guid":"c087b6c5-f73f-4ba4-a076-e8f5726b364e","subtype":"command","commandType":"auto","position":18.0,"command":"SELECT COUNT(*) FROM health_tracker_silver VERSION AS OF 0","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d33dd7ae-511e-4550-b015-8222fc766549"},{"version":"CommandV1","origId":3623476344927117,"guid":"f223e1dd-5ea8-4655-82dd-9ce7a46cf4ee","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n## Count records in our current table\n\nNow, let's count the records to see if our new data was appended as expected. Note that this data is from February 2020, which had 29 days because 2020 was a leap year. We are still working with 5 devices, with heartrate readings occurring once an hour.\n\n**`5 devices * 24 hours * 29 days`**   **`+`**   **`3720`** **`=`** **`7200 records`**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9f5c8f19-e745-4df3-96de-ecf2ee01d7b4"},{"version":"CommandV1","origId":3623476344927118,"guid":"fb365130-be9d-4ceb-abb6-dae7ce471530","subtype":"command","commandType":"auto","position":20.0,"command":"SELECT COUNT(*) FROM health_tracker_silver ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"16511cf4-40ae-4305-9a4f-f852787767b1"},{"version":"CommandV1","origId":3623476344927119,"guid":"9cd195ea-6a80-4abb-84fc-7f70a0ef391c","subtype":"command","commandType":"auto","position":21.0,"command":"%md-sandbox\n## Find missing records by device<br> \n\nLet's see if we can identify which device(s) are missing records. \n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> The absence of records from the last few days of the month shows a phenomenon that may often occur in a production data pipeline: **late-arriving data**. This can create problems in some of the other data storage and management models we talked about. If our analytics runs on stale or incomplete data, we  may draw incorrect conclusions or make bad predicitions. Delta Lake allows us to process data as it arrives and is prepared to handle the occurrence of late arriving data.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"14596869-a611-4b58-aa9e-7d6f219b336c"},{"version":"CommandV1","origId":3623476344927120,"guid":"db192e69-1bdd-4ccb-9dd7-f73b24da2a59","subtype":"command","commandType":"auto","position":22.0,"command":"SELECT p_device_id, COUNT(*) FROM health_tracker_silver GROUP BY p_device_id","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cd9635c3-3e56-47af-9a34-052ba8bcb10e"},{"version":"CommandV1","origId":3623476344927121,"guid":"fe3d6084-a53c-4f2f-b95b-69b103cb4370","subtype":"command","commandType":"auto","position":23.0,"command":"%md\n## Plot Records\nWe can run a query and use visualization tools to find out more about which dates or times are missing. For this query, it may be helpful to compare two devices, even though we're showing only one is missing data. Run the cell below to query the table. Then, click on the chart icon to plot the data. \n\nTo set up your graph: \n* Click `Plot Options`\n* Drag `dte` into the Keys dialog \n* Drag `p_device_id`into the Series Groupings dialog\n* Drag `heartrate` into the values dialog\n* Choose `COUNT` as your Aggregation type (the dropdown in the lower left corner)\n* Select \"Bar Chart\" as your display type. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d550234d-9bef-421d-93f8-9ba644a168e8"},{"version":"CommandV1","origId":3623476344927122,"guid":"284ba9e5-ed84-49da-8e8c-1ca9dcdf9d4d","subtype":"command","commandType":"auto","position":24.0,"command":"SELECT * FROM health_tracker_silver WHERE p_device_id IN (3,4)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9c43ef9c-aacb-491f-a741-426ce73f70a8"},{"version":"CommandV1","origId":3623476344927123,"guid":"6a3326ac-2815-47d3-814e-72779991397b","subtype":"command","commandType":"auto","position":25.0,"command":"%md-sandbox\n\n## Find Broken Readings \n\nIt's always useful to check for errant readings. Think about this scenario. Is there any reading would seem impossible? \n\nSince this is heartrate date, we should expect that everyone who is using the tracker has a heartbeat. Let's check the data to see if we've got any data that might point to a faulty reading. \n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> We  use a temporary view so that we can access this data again later. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0737888c-ec1e-4852-900b-ca25f93a398b"},{"version":"CommandV1","origId":3623476344927124,"guid":"c186fdd5-a2e5-4e62-8880-1f22427a4ef7","subtype":"command","commandType":"auto","position":26.0,"command":"CREATE OR REPLACE TEMPORARY VIEW broken_readings\nAS (\n  SELECT COUNT(*) as broken_readings_count, dte FROM health_tracker_silver\n  WHERE heartrate < 0\n  GROUP BY dte\n  ORDER BY dte\n)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0c58856a-31fc-461f-82a1-2a8899bffeff"},{"version":"CommandV1","origId":3623476344927125,"guid":"5b581c75-5b15-4cff-abcf-2ba02493f1bc","subtype":"command","commandType":"auto","position":27.0,"command":"%md-sandbox\n## View broken readings\n\nRun the cell and then create a a visualization that will help us get a sense of how many broken readings exist and how they are spread across the data. \n\nTo visualize this view: \n* Run the cell\n* Click the chart icon\n* Choose 'dte' as the Key and `broken_readings_count` as Values. \n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> You should notice that most days have at least one broken reading and that some days have more than one. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8668da84-1e6e-4797-9df2-7ae5fd643c05"},{"version":"CommandV1","origId":3623476344927126,"guid":"4b593a21-0873-47fd-bdc6-284849d9babb","subtype":"command","commandType":"auto","position":28.0,"command":"SELECT * FROM broken_readings;","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"01c865a3-95df-4aa8-8a72-162c56c46ce8"},{"version":"CommandV1","origId":3623476344927127,"guid":"dfb92e7d-5cfd-4cd5-b889-044432b2088e","subtype":"command","commandType":"auto","position":29.0,"command":"%md\n## Clean-up\nRun the next cell to clean up your classroom enviroment","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e982c15f-9f22-4151-9f13-8c9a2867f4a3"},{"version":"CommandV1","origId":3623476344927128,"guid":"79d0779e-136c-4495-9de6-179ffc02d282","subtype":"command","commandType":"auto","position":30.0,"command":"%run ../Includes/Classroom-Cleanup","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ae2111e3-3cd8-46a2-b48c-65114ed720fe"},{"version":"CommandV1","origId":3623476344927129,"guid":"cc7aeb04-768b-425a-8672-ff44c96401e8","subtype":"command","commandType":"auto","position":31.0,"command":"%md\nGreat job! You're officially working with Delta Lake! In the next reading, you'll continue your work to repair the broken data and missing values we discovered here. \n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6e3628ef-489b-4927-b6fa-32ae0babf22c"},{"version":"CommandV1","origId":3623476344927130,"guid":"9c860f6b-219f-40ef-b5a8-1c54f0823a6a","subtype":"command","commandType":"auto","position":32.0,"command":"%md-sandbox\n&copy; 2020 Databricks, Inc. All rights reserved.<br/>\nApache, Apache Spark, Spark and the Spark logo are trademarks of the <a href=\"http://www.apache.org/\">Apache Software Foundation</a>.<br/>\n<br/>\n<a href=\"https://databricks.com/privacy-policy\">Privacy Policy</a> | <a href=\"https://databricks.com/terms-of-use\">Terms of Use</a> | <a href=\"http://help.databricks.com/\">Support</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2f31ce65-1262-41d4-91a8-4a895b09de81"}],"dashboards":[],"guid":"314b0631-8960-423f-a313-7960b49a90db","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{}}